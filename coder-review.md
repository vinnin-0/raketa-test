# Ревью

## Миграция

- Code style (Ключевые слова в sql принято писать капсом)
- Зачем нужен id если есть uuid, который гарантированно уникален?
- Эффективнее использовать char для uuid (специфика работы БД)
- Поле category (не используется никакой связи) - скорее всего нарушение нормальной формы БД
- Поле name и description - зарезервированное значение по умолчанию, 
лучше использовать другое название или добавить кавычки
- Поле name, принято сначала писать NOT NULL, затем Default value
- Для поля price лучше использовать Decimal (дабы ограничить количество знаков после запятой), 
а также unsigned ибо цена не может быть отрицательной
- Судя по ProductRepository, по category тоже нужен поиск, было бы логично сделать индекс
- Индекс на is_active - абсолютно не эффективен из-за того, что это bool - селективности нет
(можно было бы использовать bitmap, еслиб не mysql)
- Не все таблицы прописаны!


## Структура и нейминг 
Тут конечно лучше ориентироваться на то, как принято на проекте писать, 
как я понял идея была сделать DDD, но это избыточно с такой задачей, пробую просто подкорректировать немного, 
чтоб было похоже на DDD

- В целом норм и есть четкое разделение на слои, но хотелось бы более четкого разделения и точного названия классов
    - Респонс не должен находится в директории контроллеров
    - В Домене лучше сгруппировать все по сущностям
    - В инфре лучше создать неймспейс под redis, ибо позже могут быть добавлены другие
    - Репозитории зависят от домена, лучше перенести туда
    - Вьюшки лучше переименовать в resource, чем они по сути и являются


## Код
- Общие положения
  - Практически отсутствуют phpDoc, хотя часто используются массивы объектов, полезно использовать дженерики для тайп хинтинга
  - Нет проверки на возможность писать в redis

- Контроллеры
  - Общие положения
    - Не стандартизирован ответ, предлагаю не использовать поле status, его можно понять по коду ответа и наличию  ``message``
  - AddToCartController
    - Нарушен SOLID
    - Нейминг! почему get, если по факту мы добавляем?
    Можно вообще заменить на invoke/action
    - Лучше использовать конкретный Request дабы гарантировать поля, валидацию и т.д.
    - Контроллеры должны быть тонкими, поэтому лучше перенести логику в реквест, сервис, ресурс
    - Нет логирования
    - Даже при ошибках всегда идет 200 ответ
  - 

- Нужны конкретные реквесты, там можно разместить логику валидации, особенности резолва полей
- CartManager
  - Нарушен solid
  - Не ясно зачем он нужен, если логика работы с корзинами почему-то в коннекторе, который должен реализовывать только работу с redis
  
- Вьюшки (они же ресурсы)
  - Нет единого наследника, не ООП-шно как-то
  - Product
    - Не понимаю, зачем ему из этого ресурса ходить в бд, лучше получить данные в контроллере
  - Cart
    - Проблема n+1 при сборе айтемов, делаем запросы в БД в цикле
- Connector
  - Почему он заточен работать только с корзинами
  - Не должен заниматься сериализацией
  - Лучше вынести значения на ttl в env или хотя бы константы
- ConnectorFacade
  - Вообще по идее должен скрывать в себе логику выбора конкретного коннектора и взаимодействие с ним (спишу на неправильный нейминг)
  - Занимается абсолютно не тем, чем должен
- Репозитории
  - Не используется PDO, это потенциальная уязвимость
- JsonResponse 
  - Лучше туда вынести дублирующуюся логику
  - Не знаю зачем он final, вдруг захочется сделать специфический респонс
